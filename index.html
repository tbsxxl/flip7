<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Flip 7 â€“ Score Tracker</title>
<style>
body {
    font-family: 'Segoe UI', Arial, sans-serif;
    margin: 0; padding: 0;
    background: #f5f6fa;
    color: #333;
}
.container {
    max-width: 600px;
    margin: auto;
    padding: 20px;
}
h1 {
    text-align: center;
    margin-bottom: 20px;
    font-weight: 600;
}
input, button { font-size: 1em; }
input[type=text], input[type=number] {
    padding: 8px;
    border-radius: 8px;
    border: 1px solid #ccc;
    width: calc(100% - 20px);
    margin-bottom: 10px;
}
button {
    border: none;
    border-radius: 8px;
    padding: 8px 16px;
    cursor: pointer;
}
button.green { background: #4caf50; color: #fff; }
button.red { background: #f44336; color: #fff; }
.player-box {
    background: #fff;
    border-radius: 12px;
    padding: 12px;
    margin-bottom: 12px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}
.progress-container {
    background: #e0e0e0;
    border-radius: 6px;
    height: 12px;
    margin: 6px 0;
}
.progress-bar {
    height: 100%;
    border-radius: 6px;
}
.cards {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    margin: 6px 0;
}
.card {
    padding: 6px 10px;
    border-radius: 6px;
    font-weight: 600;
    cursor: pointer;
    user-select: none;
}
.card.number { background: #e0f0ff; }
.card.action { background: #f0e0ff; }
.card.modifier { background: #fff0d0; }
.card.bonus { color: green; font-weight: bold; }
.overlay {
    display: none;
    position: fixed;
    top:0; left:0;
    width:100%; height:100%;
    background: rgba(0,0,0,0.4);
    z-index: 1000;
}
.card-popup {
    display: none;
    position: fixed;
    top:10%; left:50%;
    transform: translateX(-50%);
    width: 90%;
    max-width: 400px;
    background: #fff;
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 4px 16px rgba(0,0,0,0.2);
    z-index: 1001;
}
.card-section { margin-bottom: 12px; }
.card-section h4 { margin: 6px 0; }
.card-section .cards { gap:4px; }
#historyContainer div {
    background: #fff;
    margin: 6px 0;
    padding: 8px;
    border-radius: 8px;
    box-shadow: 0 1px 6px rgba(0,0,0,0.05);
}
</style>
</head>
<body>
<div class="container">
<h1>Flip 7 â€“ Score Tracker</h1>

<div>
    <input type="text" id="playerName" placeholder="Spielername eingeben...">
    <button onclick="addPlayer()" class="green">+</button>
</div>

<div style="margin:10px 0;">
    <label>Spielziel: </label>
    <input type="number" id="targetPoints" value="200">
</div>

<div id="playersContainer"></div>

<div>
    <button onclick="endRound()" class="green" style="width:100%; padding:12px; margin-top:10px;">Zwischenrunde beenden</button>
</div>

<div class="overlay" id="overlay" onclick="closePopup()"></div>
<div class="card-popup" id="cardPopup">
    <h3 id="popupPlayerName">Karte fÃ¼r Spieler</h3>
    
    <div class="card-section">
        <h4>Zahlenkarten (0â€“12)</h4>
        <div id="numberCards" class="cards"></div>
    </div>

    <div class="card-section">
        <h4>Aktionskarten</h4>
        <div id="actionCards" class="cards"></div>
    </div>

    <div class="card-section">
        <h4>Modifier</h4>
        <div id="modifierCards" class="cards"></div>
    </div>

    <button onclick="closePopup()" class="red" style="width:100%; margin-top:8px;">Fertig</button>
</div>

<h3>Historie abgeschlossener Runden</h3>
<div id="historyContainer">Noch keine abgeschlossenen Runden</div>
</div>

<script>
// Daten
let players = [];
let selectedPlayerIndex = null;
let history = [];
let colorPalette = ["#4caf50","#2196f3","#9c27b0","#ff9800","#f44336"];
let gameStarted = false;

// Karten
const numbers = Array.from({length:13},(_,i)=>i);
const actions = ["Freeze","Flip Three","Second Chance"];
const modifiers = ["+2","+4","+6","+8","+10","x2"];

// UI Init
const numberContainer = document.getElementById("numberCards");
const actionContainer = document.getElementById("actionCards");
const modifierContainer = document.getElementById("modifierCards");

numbers.forEach(n=>{
    let btn = document.createElement("div");
    btn.className="card number";
    btn.innerText = n;
    btn.onclick = ()=>addCardToPlayer(n);
    numberContainer.appendChild(btn);
});
actions.forEach(a=>{
    let btn = document.createElement("div");
    btn.className="card action";
    btn.innerText = a;
    btn.onclick = ()=>addCardToPlayer(a);
    actionContainer.appendChild(btn);
});
modifiers.forEach(m=>{
    let btn = document.createElement("div");
    btn.className="card modifier";
    btn.innerText = m;
    btn.onclick = ()=>addCardToPlayer(m);
    modifierContainer.appendChild(btn);
});

// Spieler
function addPlayer(){
    const name = document.getElementById("playerName").value.trim();
    if(!name) return;
    players.push({name, cards:[], totalScore:0});
    document.getElementById("playerName").value="";
    renderPlayers();
}

// Popup
function openPopup(index){
    selectedPlayerIndex=index;
    document.getElementById("popupPlayerName").innerText=`Karte fÃ¼r ${players[index].name} auswÃ¤hlen`;
    document.getElementById("cardPopup").style.display="block";
    document.getElementById("overlay").style.display="block";
}
function closePopup(){
    document.getElementById("cardPopup").style.display="none";
    document.getElementById("overlay").style.display="none";
    renderPlayers();
}

// Karte hinzufÃ¼gen / entfernen
function addCardToPlayer(card){
    if(selectedPlayerIndex===null) return;
    players[selectedPlayerIndex].cards.push(card);
    renderPlayers();
}
function removeCard(playerIndex, cardIndex){
    players[playerIndex].cards.splice(cardIndex,1);
    renderPlayers();
}

// Score live
function calculateScoreLive(player){
    let numbersArr=[], modifiersSum=0, multiplier=1, bonus=0;
    for(let card of player.cards){
        if(typeof card==="number"){
            if(numbersArr.includes(card)) return {score:0, bonus:0};
            numbersArr.push(card);
        } else if(["+2","+4","+6","+8","+10"].includes(card)) modifiersSum+=parseInt(card.replace("+",""));
        else if(card==="x2") multiplier=2;
    }
    let numbersSum = numbersArr.reduce((a,b)=>a+b,0)*multiplier;
    if(numbersArr.length===7) bonus=15;
    return {score: numbersSum + modifiersSum + bonus, bonus};
}

// Render
function renderPlayers(){
    const container = document.getElementById("playersContainer");
    container.innerHTML="";
    const target = parseInt(document.getElementById("targetPoints").value) || 200;

    players.forEach((p,i)=>{
        let {score, bonus} = calculateScoreLive(p);
        let total = p.totalScore + score;
        let cardsHTML = p.cards.map((c, idx)=>{
            let cls = "number";
            if(["Freeze","Flip Three","Second Chance"].includes(c)) cls="action";
            else if(["+2","+4","+6","+8","+10","x2"].includes(c)) cls="modifier";
            return `<div class="card ${cls}" onclick="removeCard(${i},${idx})">${c}</div>`;
        }).join("");
        let scoreHTML = `Score: ${score} Punkte`;
        if(bonus>0) scoreHTML += ` <span class="bonus">(+${bonus} Bonus)</span>`;
        let div = document.createElement("div");
        div.className="player-box";
        div.style.borderLeftColor=colorPalette[i%colorPalette.length];
        div.innerHTML=`<strong>${i+1}. ${p.name}</strong>
            <div>Gesamtpunkte: ${total}</div>
            <div class="progress-container"><div class="progress-bar" style="width:${Math.min(total/target*100,100)}%; background:${colorPalette[i%colorPalette.length]}"></div></div>
            <div>${scoreHTML}</div>
            <div class="cards">${cardsHTML}</div>
            <button onclick="openPopup(${i})" class="green" style="margin-top:4px;">Karte hinzufÃ¼gen</button>
        `;
        container.appendChild(div);
    });

    // Ziel sperren sobald das Spiel gestartet ist
    if(players.some(p=>p.cards.length>0 || p.totalScore>0)) document.getElementById("targetPoints").disabled=true;
}

// Runde beenden
function endRound(){
    gameStarted=true;
    const target = parseInt(document.getElementById("targetPoints").value) || 200;
    let roundScores=[];
    players.forEach(p=>{
        const {score}=calculateScoreLive(p);
        p.totalScore+=score;
        roundScores.push({name:p.name, score});
        p.cards=[];
    });
    history.push(roundScores);
    renderHistory();
    renderPlayers();
    players.forEach(p=>{
        if(p.totalScore>=target) alert(`ðŸŽ‰ ${p.name} hat das Spiel gewonnen!`);
    });
}

// Historie
function renderHistory(){
    const container = document.getElementById("historyContainer");
    if(history.length===0){ container.innerHTML="Noch keine abgeschlossenen Runden"; return; }
    container.innerHTML="";
    history.forEach((r,i)=>{
        let div=document.createElement("div");
        div.innerText=`Runde ${i+1}: ${r.map(p=>`${p.name} ${p.score} Pkt`).join(", ")}`;
        container.appendChild(div);
    });
}
</script>
</body>
</html>
