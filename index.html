<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Flip 7 – Score Tracker</title>

<style>
body{
 font-family:system-ui,Arial;
 background:#f6f7f9;
 margin:0;
 padding:16px;
 color:#1a1a1a;
}

h1{text-align:center;margin-bottom:20px;}

#ranking{
 background:white;
 border-radius:14px;
 padding:14px;
 margin-bottom:18px;
 box-shadow:0 3px 10px rgba(0,0,0,.06);
}

/* Ranking Farbe */
.rank-row{
 display:flex;
 align-items:center;
 gap:8px;
}
.rank-dot{
 width:12px;
 height:12px;
 border-radius:50%;
}

/* Spieler */
.player-box{
 background:white;
 border-radius:14px;
 padding:14px;
 margin-bottom:14px;
 border-left:6px solid #ccc;
 box-shadow:0 2px 6px rgba(0,0,0,.05);
 transition:.35s;
 position:relative;
}

.player-box.leader{
 transform:scale(1.02);
 box-shadow:0 10px 25px rgba(0,0,0,.12);
}

/* Floating Score */
.floatScore{
 position:absolute;
 right:20px;
 top:10px;
 font-weight:700;
 font-size:1.2rem;
 opacity:0;
 transform:translateY(0);
 animation:floatUp .9s ease forwards;
}
@keyframes floatUp{
 0%{opacity:0;transform:translateY(10px);}
 40%{opacity:1;}
 100%{opacity:0;transform:translateY(-30px);}
}

/* Progress */
.progress-container{
 background:#e7e9ed;
 height:12px;
 border-radius:6px;
 overflow:hidden;
 margin:8px 0;
}
.progress-bar{
 height:100%;
 transition:width .5s ease;
}

/* Cards */
.card-container{
 display:flex;
 flex-wrap:wrap;
 gap:8px;
 margin-top:6px;
}
.card{
 background:#eef1f5;
 padding:12px 16px;
 border-radius:10px;
 font-weight:700;
 cursor:pointer;
 min-width:44px;
 text-align:center;
}

/* Buttons */
button{
 padding:10px 16px;
 border-radius:10px;
 border:none;
 cursor:pointer;
 font-weight:600;
}
.green{background:#22c55e;color:white;}
.red{background:#ef4444;color:white;}

/* Popup */
.overlay{
 display:none;
 position:fixed;
 inset:0;
 background:rgba(0,0,0,.35);
}
.popup{
 display:none;
 position:fixed;
 top:10%;
 left:50%;
 transform:translateX(-50%);
 width:92%;
 max-width:520px;
 background:white;
 padding:22px;
 border-radius:18px;
 max-height:80%;
 overflow:auto;
}

/* Winner */
#winnerScreen{
 display:none;
 position:fixed;
 inset:0;
 background:rgba(0,0,0,.6);
 justify-content:center;
 align-items:center;
}
#winnerCard{
 background:white;
 padding:40px;
 border-radius:24px;
 text-align:center;
 box-shadow:0 25px 60px rgba(0,0,0,.25);
}

@media(max-width:600px){
 #numberCards,#modifierCards{
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:8px;
 }
 .card{
  padding:16px 0;
  font-size:1.1rem;
 }
}
</style>
</head>

<body>

<h1>Flip 7 – Score Tracker</h1>

<div id="ranking"></div>

<div>
<input id="playerName" placeholder="Spielername">
<button class="green" onclick="addPlayer()">+</button>
</div>

<div style="margin:12px 0;">
Spielziel:
<input type="number" id="targetPoints" value="200">
</div>

<div id="playersContainer"></div>

<button class="green" style="width:100%" onclick="endRound()">Zwischenrunde beenden</button>

<h3>Statistik</h3>
<div id="stats"></div>

<div class="overlay" id="overlay" onclick="closePopup()"></div>

<div class="popup" id="popup">
<h3 id="popupTitle"></h3>
<input id="manualNumber" type="number" placeholder="Zahl eingeben">

<h4>Zahlen</h4>
<div id="numberCards" class="card-container"></div>

<h4>Modifier</h4>
<div id="modifierCards" class="card-container"></div>

<button class="red" style="width:100%" onclick="closePopup()">Fertig</button>
</div>

<div id="winnerScreen">
 <div id="winnerCard">
  <h2 id="winnerText"></h2>
  <button class="green" onclick="resetGame()">Neues Spiel</button>
 </div>
</div>

<script>
let players=[];
let selectedPlayer=null;

const palette=[
 "#2563eb","#16a34a","#ea580c","#9333ea",
 "#0ea5e9","#dc2626","#14b8a6","#eab308"
];

const numbers=[...Array(13).keys()];
const modifiers=["+2","+4","+6","+8","+10","x2"];

/* Karten */
numbers.forEach(n=>{
 let d=document.createElement("div");
 d.className="card";
 d.innerText=n;
 d.onclick=()=>addCard(n);
 numberCards.appendChild(d);
});
modifiers.forEach(m=>{
 let d=document.createElement("div");
 d.className="card";
 d.innerText=m;
 d.onclick=()=>addCard(m);
 modifierCards.appendChild(d);
});

/* Spieler */
function addPlayer(){
 let name=playerName.value.trim();
 if(!name) return;

 players.push({
  name,
  color: palette[players.length % palette.length],
  cards:[],
  total:0,
  rounds:[],
  lastScore:null
 });

 playerName.value="";
 renderAll();
}

/* Bust Check */
function hasDuplicateNumbers(cards){
 let nums=cards.filter(c=>typeof c==="number");
 return new Set(nums).size !== nums.length;
}

/* Score */
function calc(p){
 if(hasDuplicateNumbers(p.cards)) return 0;

 let nums=[], mod=0, multi=1;

 p.cards.forEach(c=>{
  if(typeof c==="number") nums.push(c);
  else if(c==="x2") multi=2;
  else if(c.startsWith("+")) mod+=+c.slice(1);
 });

 let sum=nums.reduce((a,b)=>a+b,0)*multi;
 if(nums.length===7) sum+=15;
 return sum+mod;
}

/* Ranking */
function renderRanking(){
 let list=[...players].map(p=>({
  name:p.name,
  color:p.color,
  score:p.total+calc(p)
 })).sort((a,b)=>b.score-a.score);

 ranking.innerHTML="<strong>Führung</strong><br>"+
 list.map((p,i)=>`
 <div class="rank-row">
  ${i+1}.
  <div class="rank-dot" style="background:${p.color}"></div>
  ${p.name} – ${p.score}
 </div>
 `).join("");
}

function getLeader(){
 let best=-1,score=-1;
 players.forEach((p,i)=>{
  let s=p.total+calc(p);
  if(s>score){score=s;best=i;}
 });
 return best;
}

/* Spieler Render */
function renderPlayers(){
 playersContainer.innerHTML="";
 let leader=getLeader();

 players.forEach((p,i)=>{
  let live=calc(p);
  let total=p.total+live;

  let div=document.createElement("div");
  div.className="player-box";
  if(i===leader) div.classList.add("leader");
  div.style.borderLeftColor=p.color;

  div.innerHTML=`
  <strong>${p.name}</strong>
  ${p.lastScore!=null?`<div class="floatScore">+${p.lastScore}</div>`:""}
  <div class="progress-container">
   <div class="progress-bar" style="width:${total/targetPoints.value*100}%; background:${p.color}"></div>
  </div>
  Runde: ${live} | Gesamt: ${total}
  <div class="card-container">
   ${p.cards.map((c,ci)=>`<div class="card" onclick="removeCard(${i},${ci})">${c}</div>`).join("")}
  </div>
  <button class="green" style="width:100%" onclick="openPopup(${i})">Karte hinzufügen</button>
  `;
  playersContainer.appendChild(div);
 });
}

/* Statistik */
function renderStats(){
 let html="";
 players.forEach(p=>{
  let avg=(p.rounds.reduce((a,b)=>a+b,0)/p.rounds.length||0).toFixed(1);
  html+=`${p.name}: Ø ${avg}<br>`;
 });
 stats.innerHTML=html || "Noch keine Daten";
}

/* Popup */
function openPopup(i){
 selectedPlayer=i;
 popup.style.display="block";
 overlay.style.display="block";
 popupTitle.innerText="Karte für "+players[i].name;
 setTimeout(()=>manualNumber.focus(),50);
}
function closePopup(){
 popup.style.display="none";
 overlay.style.display="none";
 renderAll();
}

/* Karten */
function addCard(c){
 if(selectedPlayer==null) return;
 players[selectedPlayer].cards.push(c);
 renderAll();
}
function removeCard(p,c){
 players[p].cards.splice(c,1);
 renderAll();
}

/* Winner */
function showWinner(name){
 winnerText.innerText=name+" gewinnt!";
 winnerScreen.style.display="flex";
}
function resetGame(){
 winnerScreen.style.display="none";
 players.forEach(p=>{
  p.total=0;
  p.cards=[];
  p.rounds=[];
  p.lastScore=null;
 });
 renderAll();
}

/* Runde Ende */
function endRound(){
 let target=+targetPoints.value||200;

 players.forEach(p=>{
  let s=calc(p);
  p.total+=s;
  p.rounds.push(s);
  p.lastScore=s;
  p.cards=[];
 });

 let win=players.find(p=>p.total>=target);
 if(win) showWinner(win.name);

 renderAll();

 setTimeout(()=>{
  players.forEach(p=>p.lastScore=null);
  renderPlayers();
 },1000);
}

/* Render */
function renderAll(){
 renderRanking();
 renderPlayers();
 renderStats();
}
</script>

</body>
</html>
